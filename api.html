<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Create Air Condition</title>

<style>
body{
  font-family:Arial;
  max-width:700px;
  margin:40px auto;
}

input,select,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
}

button{
  font-size:18px;
  cursor:pointer;
}

pre{
  background:#0f172a;
  color:#e5e7eb;
  padding:12px;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<h2>‚ùÑ Create Air Condition</h2>

<h3>Login</h3>

<input id="username" value="admin">
<input id="password" type="password" value="smartroom">

<h3>Device Info</h3>

<input id="naturalId" placeholder="naturalId (VD: AC001)">
<input id="name" placeholder="T√™n m√°y l·∫°nh">

<input id="roomId" placeholder="Room ID" value="1">
<input id="deviceControlId" placeholder="Gateway ID">

<select id="power">
  <option>ON</option>
  <option>OFF</option>
</select>

<input id="temperature" type="number" min="16" max="32" value="24">

<label>
<input id="isActive" type="checkbox" checked>
Active
</label>

<button onclick="createAir()">üöÄ CREATE</button>

<pre id="out">Ready...</pre>

<script>
const BASE="http://192.168.2.29:8080/api/v1";

let TOKEN="";

const out=document.getElementById("out");

// ===== LOGIN =====
async function login(){

  const res=await fetch(BASE+"/auth/signin",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      username:username.value,
      password:password.value
    })
  });

  const j=await res.json();

  TOKEN=j.data?.token || j.data?.accessToken || j.token;

  if(!TOKEN) throw "Login failed";

  out.textContent="‚úÖ Logged in";
}

// ===== CREATE =====
async function createAir(){

try{

  if(!TOKEN) await login();

  const body={
    naturalId:naturalId.value,
    name:name.value,
    roomId:Number(roomId.value),
    deviceControlId: deviceControlId.value ? Number(deviceControlId.value):null,
    langCode:"vi",
    isActive:isActive.checked,
    power:power.value,
    temperature:Number(temperature.value)
  };

  const res=await fetch(BASE+"/air-conditions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:"Bearer "+TOKEN
    },
    body:JSON.stringify(body)
  });

  const text=await res.text();

  out.textContent=
`STATUS: ${res.status}

BODY:
${text}`;

}catch(e){
  out.textContent="‚ùå "+e;
}

}
</script>

</body>
</html>
